import os

image_orig = bytearray(open("./Koala.jpg", "rb").read(2048))
image_enc = bytearray(open("./EncryptedFiles/Pictures/Sample Pictures/Koala.jpg_encrypted", "rb").read(2048))

key = []

for i in range(32):
	key.append(image_enc[i]^image_orig[i])

print("Key: {}".format(key))

print("Decrypting flag...")

f = bytearray(open("./EncryptedFiles/Documents/flag.txt_encrypted", "rb").read())

flag = ""

for i in range(len(f)):
	flag += chr(f[i]^key[i%32])

print("Flag: {}".format(flag))
print("Done.")

print("\nDecrypting all files")


for i in os.listdir('./EncryptedFiles/Pictures/Sample Pictures'):
	img = []
	if i=="desktop.ini":
		continue
	img_data = bytearray(open("./EncryptedFiles/Pictures/Sample Pictures/"+i, "rb").read())
	for j in range(len(img_data)):
		img.append(img_data[j]^key[j%32])

	with open("./DecryptedFiles/Pictures/Sample Pictures/"+i.split('_')[0], "wb") as w:
		w.write(bytearray(img))


for i in os.listdir('./EncryptedFiles/Documents'):
	img = []
	if i=="desktop.ini":
		continue
	img_data = bytearray(open("./EncryptedFiles/Documents/"+i, "rb").read())
	for j in range(len(img_data)):
		img.append(img_data[j]^key[j%32])

	with open("./DecryptedFiles/Documents/"+i.split('_')[0], "wb") as w:
		w.write(bytearray(img))

print("Done.")